{"sliceID":356524144169200018,"uses":[{"reference":{"otherSlice":6658493354337671128},"usedName":{"constructorName":{"identifier":"Text"},"constructorTypeName":{"identifier":"Text"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"otherSlice":4791260247128078865},"usedName":{"valueName":{"identifier":"empty"}},"qualification":"B"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO.Unsafe"},"usedName":{"valueName":{"identifier":"unsafeDupablePerformIO"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":5831756764704217508},"usedName":{"valueName":{"identifier":"mallocByteString"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"*"}},"qualification":null},{"reference":{"builtinModule":"Foreign.ForeignPtr"},"usedName":{"valueName":{"identifier":"withForeignPtr"}},"qualification":null},{"reference":{"builtinModule":"Foreign.Marshal.Utils"},"usedName":{"valueName":{"identifier":"with"}},"qualification":null},{"reference":{"otherSlice":917105822812322474},"usedName":{"valueName":{"identifier":"c_encode_utf8"}},"qualification":null},{"reference":{"otherSlice":6880979574363404356},"usedName":{"valueName":{"identifier":"aBA"}},"qualification":"A"},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"fromIntegral"}},"qualification":null},{"reference":{"builtinModule":"Foreign.Storable"},"usedName":{"valueName":{"identifier":"peek"}},"qualification":null},{"reference":{"builtinModule":"GHC.Ptr"},"usedName":{"valueName":{"identifier":"minusPtr"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":">="}},"qualification":null},{"reference":{"otherSlice":5928679534711299048},"usedName":{"valueName":{"identifier":"shiftR"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"constructorName":{"identifier":"PS"},"constructorTypeName":{"identifier":"ByteString"}},"qualification":null},{"reference":{"otherSlice":811219613042846892},"usedName":{"valueName":{"identifier":"memcpy"}},"qualification":null},{"reference":{"otherSlice":6658493354337671128},"usedName":{"typeName":{"identifier":"Text"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":null}],"fragment":["encodeUtf8 :: Text -> ByteString","encodeUtf8 (Text arr off len)\n  | len == 0 = B.empty\n  | otherwise =\n    unsafeDupablePerformIO $\n      do fp <- mallocByteString (len * 4)\n         withForeignPtr fp $\n           \\ ptr ->\n             with ptr $\n               \\ destPtr ->\n                 do c_encode_utf8 destPtr (A.aBA arr) (fromIntegral off)\n                      (fromIntegral len)\n                    newDest <- peek destPtr\n                    let utf8len = newDest `minusPtr` ptr\n                    if utf8len >= len `shiftR` 1 then return (PS fp 0 utf8len) else\n                      do fp' <- mallocByteString utf8len\n                         withForeignPtr fp' $\n                           \\ ptr' ->\n                             do memcpy ptr' ptr (fromIntegral utf8len)\n                                return (PS fp' 0 utf8len)"],"instances":[],"language":{"extensions":["BangPatterns","ForeignFunctionInterface","GeneralizedNewtypeDeriving","MagicHash","UnliftedFFITypes","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}