{"sliceID":8444244137189822489,"uses":[{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":5586534436958027561},"usedName":{"valueName":{"identifier":"newContext"}},"qualification":null},{"reference":{"otherSlice":4601787771439204142},"usedName":{"valueName":{"identifier":"start"}},"qualification":null},{"reference":{"otherSlice":2708884142443134907},"usedName":{"valueName":{"identifier":"response"}},"qualification":null},{"reference":{"otherSlice":4652915608943686032},"usedName":{"valueName":{"identifier":"worker"}},"qualification":null},{"reference":{"otherSlice":8293656948725908080},"usedName":{"valueName":{"identifier":"setAction"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"replicateM_"}},"qualification":null},{"reference":{"otherSlice":3179274283845055384},"usedName":{"valueName":{"identifier":"spawnAction"}},"qualification":null},{"reference":{"otherSlice":8105102055173966168},"usedName":{"valueName":{"identifier":"mkRequest"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"forkIO"}},"qualification":null},{"reference":{"otherSlice":1535145737897496002},"usedName":{"valueName":{"identifier":"frameReceiver"}},"qualification":null},{"reference":{"otherSlice":1324898490002480693},"usedName":{"valueName":{"identifier":"frameSender"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"finally"}},"qualification":"E"},{"reference":{"otherSlice":4520051023135969888},"usedName":{"valueName":{"identifier":"clearContext"}},"qualification":null},{"reference":{"otherSlice":5814443341629488124},"usedName":{"valueName":{"identifier":"stop"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"killThread"}},"qualification":null},{"reference":{"otherSlice":7537180873733986230},"usedName":{"constructorName":{"identifier":"TCP"},"constructorTypeName":{"identifier":"Transport"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"otherSlice":1796924442603164872},"usedName":{"valueName":{"identifier":"goaway"}},"qualification":null},{"reference":{"otherSlice":4373455107983741140},"usedName":{"constructorName":{"identifier":"InadequateSecurity"},"constructorTypeName":{"identifier":"ErrorCodeId"}},"qualification":null},{"reference":{"otherSlice":7537180873733986230},"usedName":{"valueName":{"identifier":"tlsMajorVersion"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"&&"}},"qualification":null},{"reference":{"otherSlice":7537180873733986230},"usedName":{"valueName":{"identifier":"tlsMinorVersion"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":">="}},"qualification":null},{"reference":{"otherSlice":3575254307126372533},"usedName":{"valueName":{"identifier":"connectionPrefaceLength"}},"qualification":null},{"reference":{"otherSlice":6517602901884670158},"usedName":{"valueName":{"identifier":"connectionPreface"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"/="}},"qualification":null},{"reference":{"otherSlice":4373455107983741140},"usedName":{"constructorName":{"identifier":"ProtocolError"},"constructorTypeName":{"identifier":"ErrorCodeId"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":2455091088557061440},"usedName":{"typeName":{"identifier":"Connection"}},"qualification":null},{"reference":{"otherSlice":7131233874288028310},"usedName":{"typeName":{"identifier":"InternalInfo1"}},"qualification":null},{"reference":{"otherSlice":2694158817781932873},"usedName":{"typeName":{"identifier":"SockAddr"}},"qualification":null},{"reference":{"otherSlice":7537180873733986230},"usedName":{"typeName":{"identifier":"Transport"}},"qualification":null},{"reference":{"otherSlice":7471038449729235448},"usedName":{"typeName":{"identifier":"Settings"}},"qualification":"S"},{"reference":{"otherSlice":4569852275802132727},"usedName":{"typeName":{"identifier":"BufSize"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":null},{"reference":{"otherSlice":628686228066488211},"usedName":{"typeName":{"identifier":"Application"}},"qualification":null}],"fragment":["http2 ::\n      Connection ->\n        InternalInfo1 ->\n          SockAddr ->\n            Transport ->\n              S.Settings -> (BufSize -> IO ByteString) -> Application -> IO ()","http2 conn ii1 addr transport settings readN app\n  = do checkTLS\n       ok <- checkPreface\n       when ok $\n         do ctx <- newContext\n            mgr <- start settings\n            let responder = response settings ctx mgr\n                action = worker ctx settings app responder\n            setAction mgr action\n            replicateM_ 3 $ spawnAction mgr\n            let mkreq = mkRequest ii1 settings addr\n            tid <- forkIO $ frameReceiver ctx mkreq readN\n            frameSender ctx conn settings mgr `E.finally`\n              do clearContext ctx\n                 stop mgr\n                 killThread tid\n  where checkTLS\n          = case transport of\n                TCP -> return ()\n                tls -> unless (tls12orLater tls) $\n                         goaway conn InadequateSecurity \"Weak TLS\"\n        tls12orLater tls\n          = tlsMajorVersion tls == 3 && tlsMinorVersion tls >= 3\n        checkPreface\n          = do preface <- readN connectionPrefaceLength\n               if connectionPreface /= preface then\n                 do goaway conn ProtocolError \"Preface mismatch\"\n                    return False\n                 else return True"],"instances":[],"language":{"extensions":["OverloadedStrings","RecordWildCards","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}