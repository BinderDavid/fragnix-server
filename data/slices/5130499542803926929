{"sliceID":5130499542803926929,"uses":[{"reference":{"otherSlice":428493621648958047},"usedName":{"valueName":{"identifier":"hasBody"}},"qualification":null},{"reference":{"otherSlice":6829787869120220833},"usedName":{"valueName":{"identifier":"sendRsp"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":1163553957919013733},"usedName":{"valueName":{"identifier":"tickle"}},"qualification":"T"},{"reference":{"otherSlice":2152696022490846563},"usedName":{"constructorName":{"identifier":"RspNoBody"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"otherSlice":7471038449729235448},"usedName":{"valueName":{"identifier":"settingsServerName"}},"qualification":null},{"reference":{"otherSlice":7471038449729235448},"usedName":{"valueName":{"identifier":"settingsLogger"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"httpVersion"}},"qualification":null},{"reference":{"otherSlice":9145736869574180767},"usedName":{"valueName":{"identifier":"responseStatus"}},"qualification":null},{"reference":{"otherSlice":4913986324524013599},"usedName":{"valueName":{"identifier":"sanitizeHeaders"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":551714491366486876},"usedName":{"valueName":{"identifier":"responseHeaders"}},"qualification":null},{"reference":{"otherSlice":3763724332986665435},"usedName":{"valueName":{"identifier":"indexResponseHeader"}},"qualification":null},{"reference":{"otherSlice":27681834806193008},"usedName":{"valueName":{"identifier":"threadHandle"}},"qualification":null},{"reference":{"otherSlice":27681834806193008},"usedName":{"valueName":{"identifier":"getDate"}},"qualification":null},{"reference":{"otherSlice":7191620484277478947},"usedName":{"valueName":{"identifier":"addDate"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"otherSlice":8133360397315507274},"usedName":{"valueName":{"identifier":"addServer"}},"qualification":null},{"reference":{"otherSlice":6004183068882937891},"usedName":{"valueName":{"identifier":"infoFromRequest"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"identifier":"not"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"&&"}},"qualification":null},{"reference":{"otherSlice":1712919843719411999},"usedName":{"valueName":{"identifier":"infoFromResponse"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestMethod"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"otherSlice":3741126862016059343},"usedName":{"valueName":{"identifier":"methodHead"}},"qualification":"H"},{"reference":{"otherSlice":8218805848122191995},"usedName":{"constructorName":{"identifier":"ResponseFile"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":2152696022490846563},"usedName":{"constructorName":{"identifier":"RspFile"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"otherSlice":8218805848122191995},"usedName":{"constructorName":{"identifier":"ResponseBuilder"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":2152696022490846563},"usedName":{"constructorName":{"identifier":"RspBuilder"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"otherSlice":8218805848122191995},"usedName":{"constructorName":{"identifier":"ResponseStream"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":2152696022490846563},"usedName":{"constructorName":{"identifier":"RspStream"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"otherSlice":8218805848122191995},"usedName":{"constructorName":{"identifier":"ResponseRaw"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"otherSlice":2152696022490846563},"usedName":{"constructorName":{"identifier":"RspRaw"},"constructorTypeName":{"identifier":"Rsp"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":7471038449729235448},"usedName":{"typeName":{"identifier":"Settings"}},"qualification":null},{"reference":{"otherSlice":2455091088557061440},"usedName":{"typeName":{"identifier":"Connection"}},"qualification":null},{"reference":{"otherSlice":27681834806193008},"usedName":{"typeName":{"identifier":"InternalInfo"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"typeName":{"identifier":"Request"}},"qualification":null},{"reference":{"otherSlice":7539027878723779009},"usedName":{"typeName":{"identifier":"IndexedHeader"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":null},{"reference":{"otherSlice":8218805848122191995},"usedName":{"typeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Bool"}},"qualification":null}],"fragment":["sendResponse ::\n             Settings ->\n               Connection ->\n                 InternalInfo ->\n                   Request -> IndexedHeader -> IO ByteString -> Response -> IO Bool","sendResponse settings conn ii req reqidxhdr src response\n  = do hs <- addServerAndDate hs0\n       if hasBody s then\n         do (ms, mlen) <- sendRsp conn ii ver s hs rsp\n            case ms of\n                Nothing -> return ()\n                Just realStatus -> logger req realStatus mlen\n            T.tickle th\n            return ret\n         else\n         do _ <- sendRsp conn ii ver s hs RspNoBody\n            logger req s Nothing\n            T.tickle th\n            return isPersist\n  where defServer = settingsServerName settings\n        logger = settingsLogger settings\n        ver = httpVersion req\n        s = responseStatus response\n        hs0 = sanitizeHeaders $ responseHeaders response\n        rspidxhdr = indexResponseHeader hs0\n        th = threadHandle ii\n        getdate = getDate ii\n        addServerAndDate\n          = addDate getdate rspidxhdr . addServer defServer rspidxhdr\n        (isPersist, isChunked0) = infoFromRequest req reqidxhdr\n        isChunked = not isHead && isChunked0\n        (isKeepAlive, needsChunked)\n          = infoFromResponse rspidxhdr (isPersist, isChunked)\n        isHead = requestMethod req == H.methodHead\n        rsp\n          = case response of\n                ResponseFile _ _ path mPart -> RspFile path mPart reqidxhdr isHead\n                                                 (T.tickle th)\n                ResponseBuilder _ _ b | isHead -> RspNoBody\n                                      | otherwise -> RspBuilder b needsChunked\n                ResponseStream _ _ fb | isHead -> RspNoBody\n                                      | otherwise -> RspStream fb needsChunked th\n                ResponseRaw raw _ -> RspRaw raw src (T.tickle th)\n        !ret\n          = case response of\n                ResponseFile{} -> isPersist\n                ResponseBuilder{} -> isKeepAlive\n                ResponseStream{} -> isKeepAlive\n                ResponseRaw{} -> False"],"instances":[],"language":{"extensions":["OverloadedStrings","ScopedTypeVariables","TupleSections","RankNTypes","BangPatterns","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}