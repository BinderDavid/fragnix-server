{"sliceID":4939875234466968983,"uses":[{"reference":{"otherSlice":6235759135567817074},"usedName":{"constructorName":{"identifier":"STM"},"constructorTypeName":{"identifier":"STM"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"readIORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.IORef"},"usedName":{"valueName":{"identifier":"writeIORef"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"try"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"constructorName":{"identifier":"Left"},"constructorTypeName":{"identifier":"Either"}},"qualification":null},{"reference":{"otherSlice":3203607607972479836},"usedName":{"valueName":{"identifier":"unSTM"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"constructorName":{"identifier":"Right"},"constructorTypeName":{"identifier":"Either"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"typeName":{"identifier":"Exception"}},"qualification":null},{"reference":{"otherSlice":6235759135567817074},"usedName":{"typeName":{"identifier":"STM"}},"qualification":null}],"fragment":["catchSTM :: Exception e => STM a -> (e -> STM a) -> STM a","catchSTM (STM m) h\n  = STM $\n      \\ r ->\n        do old_rollback <- readIORef r\n           writeIORef r (return ())\n           res <- try (m r)\n           rollback_m <- readIORef r\n           case res of\n               Left ex -> do rollback_m\n                             writeIORef r old_rollback\n                             unSTM (h ex) r\n               Right a -> do writeIORef r (rollback_m >> old_rollback)\n                             return a"],"instances":[],"language":{"extensions":["MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}