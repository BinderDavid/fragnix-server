{"sliceID":5590242452502338671,"uses":[{"reference":{"otherSlice":4266482746038848749},"usedName":{"valueName":{"identifier":"pack"}},"qualification":"B"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":4632844090767036122},"usedName":{"valueName":{"identifier":"lookup'"}},"qualification":null},{"reference":{"otherSlice":6444259019906843063},"usedName":{"valueName":{"identifier":"safeRead"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"lookup"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"map"}},"qualification":null},{"reference":{"builtinModule":"GHC.Unicode"},"usedName":{"valueName":{"identifier":"toLower"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":2971289438803712817},"usedName":{"valueName":{"identifier":"getAddrInfo"}},"qualification":null},{"reference":{"otherSlice":1781973223832186205},"usedName":{"valueName":{"identifier":"addrAddress"}},"qualification":null},{"reference":{"builtinModule":"GHC.Err"},"usedName":{"valueName":{"identifier":"error"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"++"}},"qualification":null},{"reference":{"otherSlice":4366838952886361872},"usedName":{"valueName":{"identifier":"cleanupVarName"}},"qualification":null},{"reference":{"builtinModule":"Control.Arrow"},"usedName":{"valueName":{"operator":"***"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"constructorName":{"identifier":"Request"},"constructorTypeName":{"identifier":"Request"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestMethod"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"rawPathInfo"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"pathInfo"}},"qualification":null},{"reference":{"otherSlice":3579314455847880429},"usedName":{"valueName":{"identifier":"decodePathSegments"}},"qualification":"H"},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"rawQueryString"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"queryString"}},"qualification":null},{"reference":{"otherSlice":3133621383246103626},"usedName":{"valueName":{"identifier":"parseQuery"}},"qualification":"H"},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestHeaders"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"isSecure"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"remoteHost"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"httpVersion"}},"qualification":null},{"reference":{"otherSlice":4010824518276340647},"usedName":{"valueName":{"identifier":"http11"}},"qualification":"H"},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestBody"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"vault"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"mempty"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestBodyLength"}},"qualification":null},{"reference":{"otherSlice":2778711971517543461},"usedName":{"constructorName":{"identifier":"KnownLength"},"constructorTypeName":{"identifier":"RequestBodyLength"}},"qualification":null},{"reference":{"builtinModule":"GHC.Real"},"usedName":{"valueName":{"identifier":"fromIntegral"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestHeaderHost"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestHeaderRange"}},"qualification":null},{"reference":{"otherSlice":2325900752127330681},"usedName":{"valueName":{"identifier":"hRange"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestHeaderReferer"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestHeaderUserAgent"}},"qualification":null},{"reference":{"builtinModule":"Data.Functor"},"usedName":{"valueName":{"identifier":"void"}},"qualification":null},{"reference":{"otherSlice":8218805848122191995},"usedName":{"constructorName":{"identifier":"ResponseFile"},"constructorTypeName":{"identifier":"Response"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"mapM_"}},"qualification":null},{"reference":{"otherSlice":7987649984260342197},"usedName":{"valueName":{"identifier":"toChunks"}},"qualification":"L"},{"reference":{"otherSlice":1308562469710694256},"usedName":{"valueName":{"identifier":"toLazyByteString"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":1101192067246769824},"usedName":{"constructorName":{"identifier":"ResponseReceived"},"constructorTypeName":{"identifier":"ResponseReceived"}},"qualification":null},{"reference":{"otherSlice":151727817086787467},"usedName":{"valueName":{"identifier":"responseToStream"}},"qualification":null},{"reference":{"otherSlice":5942701355812422116},"usedName":{"valueName":{"identifier":"newBlazeRecv"}},"qualification":"Blaze"},{"reference":{"otherSlice":3273621015017421231},"usedName":{"valueName":{"identifier":"defaultStrategy"}},"qualification":"Blaze"},{"reference":{"builtinModule":"Data.Function"},"usedName":{"valueName":{"identifier":"fix"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"identifier":"unless"}},"qualification":null},{"reference":{"otherSlice":5578418172209195165},"usedName":{"valueName":{"identifier":"null"}},"qualification":"B"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"mappend"}},"qualification":null},{"reference":{"otherSlice":3564279037948798687},"usedName":{"valueName":{"identifier":"fromChar"}},"qualification":null},{"reference":{"otherSlice":6119776282763598804},"usedName":{"valueName":{"identifier":"flush"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>="}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"mconcat"}},"qualification":null},{"reference":{"otherSlice":7141813878342627361},"usedName":{"constructorName":{"identifier":"Status"},"constructorTypeName":{"identifier":"Status"}},"qualification":null},{"reference":{"otherSlice":6863249147699497121},"usedName":{"valueName":{"identifier":"fromByteString"}},"qualification":null},{"reference":{"otherSlice":7439254718984233752},"usedName":{"valueName":{"identifier":"fromString"}},"qualification":null},{"reference":{"builtinModule":"GHC.Show"},"usedName":{"valueName":{"identifier":"show"}},"qualification":null},{"reference":{"otherSlice":3945053944125703351},"usedName":{"valueName":{"identifier":"original"}},"qualification":"CI"},{"reference":{"otherSlice":2325900752127330681},"usedName":{"valueName":{"identifier":"hContentType"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"typeName":{"identifier":"String"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Int"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":"B"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"typeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":628686228066488211},"usedName":{"typeName":{"identifier":"Application"}},"qualification":null}],"fragment":["runGeneric ::\n           [(String, String)] ->\n             (Int -> IO (IO B.ByteString)) ->\n               (B.ByteString -> IO ()) ->\n                 Maybe B.ByteString -> Application -> IO ()","runGeneric vars inputH outputH xsendfile app\n  = do let rmethod = B.pack $ lookup' \"REQUEST_METHOD\" vars\n           pinfo = lookup' \"PATH_INFO\" vars\n           qstring = lookup' \"QUERY_STRING\" vars\n           contentLength = safeRead 0 $ lookup' \"CONTENT_LENGTH\" vars\n           remoteHost'\n             = case lookup \"REMOTE_ADDR\" vars of\n                   Just x -> x\n                   Nothing -> case lookup \"REMOTE_HOST\" vars of\n                                  Just x -> x\n                                  Nothing -> \"\"\n           isSecure'\n             = case map toLower $ lookup' \"SERVER_PROTOCOL\" vars of\n                   \"https\" -> True\n                   _ -> False\n       addrs <- getAddrInfo Nothing (Just remoteHost') Nothing\n       requestBody' <- inputH contentLength\n       let addr\n             = case addrs of\n                   a : _ -> addrAddress a\n                   [] -> error $ \"Invalid REMOTE_ADDR or REMOTE_HOST: \" ++ remoteHost'\n           reqHeaders = map (cleanupVarName *** B.pack) vars\n           env\n             = Request{requestMethod = rmethod, rawPathInfo = B.pack pinfo,\n                       pathInfo = H.decodePathSegments $ B.pack pinfo,\n                       rawQueryString = B.pack qstring,\n                       queryString = H.parseQuery $ B.pack qstring,\n                       requestHeaders = reqHeaders, isSecure = isSecure',\n                       remoteHost = addr, httpVersion = H.http11,\n                       requestBody = requestBody', vault = mempty,\n                       requestBodyLength = KnownLength $ fromIntegral contentLength,\n                       requestHeaderHost = lookup \"host\" reqHeaders,\n                       requestHeaderRange = lookup hRange reqHeaders,\n                       requestHeaderReferer = lookup \"referer\" reqHeaders,\n                       requestHeaderUserAgent = lookup \"user-agent\" reqHeaders}\n       void $\n         app env $\n           \\ res ->\n             case (xsendfile, res) of\n                 (Just sf, ResponseFile s hs fp Nothing) -> do mapM_ outputH $\n                                                                 L.toChunks $\n                                                                   toLazyByteString $\n                                                                     sfBuilder s hs sf fp\n                                                               return ResponseReceived\n                 _ -> do let (s, hs, wb) = responseToStream res\n                         (blazeRecv, blazeFinish) <- Blaze.newBlazeRecv\n                                                       Blaze.defaultStrategy\n                         wb $\n                           \\ b ->\n                             do let sendBuilder builder\n                                      = do popper <- blazeRecv builder\n                                           fix $\n                                             \\ loop ->\n                                               do bs <- popper\n                                                  unless (B.null bs) $\n                                                    do outputH bs\n                                                       loop\n                                sendBuilder $ headers s hs `mappend` fromChar '\\n'\n                                b sendBuilder (sendBuilder flush)\n                         blazeFinish >>= maybe (return ()) outputH\n                         return ResponseReceived\n  where headers s hs\n          = mconcat (map header $ status s : map header' (fixHeaders hs))\n        status (Status i m)\n          = (fromByteString \"Status\",\n             mconcat [fromString $ show i, fromChar ' ', fromByteString m])\n        header' (x, y) = (fromByteString $ CI.original x, fromByteString y)\n        header (x, y) = mconcat [x, fromByteString \": \", y, fromChar '\\n']\n        sfBuilder s hs sf fp\n          = mconcat\n              [headers s hs, header $ (fromByteString sf, fromString fp),\n               fromChar '\\n', fromByteString sf, fromByteString \" not supported\"]\n        fixHeaders h\n          = case lookup hContentType h of\n                Nothing -> (hContentType, \"text/html; charset=utf-8\") : h\n                Just _ -> h"],"instances":[],"language":{"extensions":["OverloadedStrings","RankNTypes","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}