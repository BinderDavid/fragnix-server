{"sliceID":7537561057229802096,"uses":[{"reference":{"builtinModule":"GHC.IO"},"usedName":{"typeName":{"identifier":"FilePath"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"builtinModule":"System.IO.Error"},"usedName":{"valueName":{"identifier":"modifyIOError"}},"qualification":null},{"reference":{"otherSlice":4240602345081494639},"usedName":{"valueName":{"identifier":"ioeAddLocation"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"builtinModule":"System.IO.Error"},"usedName":{"valueName":{"identifier":"ioeSetFileName"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":3448631995573570914},"usedName":{"valueName":{"identifier":"dropTrailingPathSeparator"}},"qualification":null},{"reference":{"otherSlice":4141147330045880544},"usedName":{"valueName":{"identifier":"normalise"}},"qualification":null},{"reference":{"builtinModule":"Data.Functor"},"usedName":{"valueName":{"operator":"<$>"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"=<<"}},"qualification":null},{"reference":{"otherSlice":7760104203888106422},"usedName":{"valueName":{"identifier":"prependCurrentDirectory"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO.Encoding"},"usedName":{"valueName":{"identifier":"getFileSystemEncoding"}},"qualification":null},{"reference":{"builtinModule":"GHC.Foreign"},"usedName":{"valueName":{"identifier":"withCString"}},"qualification":"GHC"},{"reference":{"otherSlice":7629259795506942427},"usedName":{"valueName":{"identifier":"withRealpath"}},"qualification":null},{"reference":{"builtinModule":"GHC.Foreign"},"usedName":{"valueName":{"identifier":"peekCString"}},"qualification":"GHC"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Int"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad"},"usedName":{"valueName":{"operator":"<=<"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<="}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"reverse"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"zip"}},"qualification":null},{"reference":{"otherSlice":7510267215648460701},"usedName":{"valueName":{"identifier":"splitDirectories"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"scanl1"}},"qualification":null},{"reference":{"otherSlice":6570118788296286238},"usedName":{"valueName":{"operator":"</>"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"tail"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"scanr"}},"qualification":null},{"reference":{"otherSlice":7812457657846572504},"usedName":{"valueName":{"identifier":"doesPathExist"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"identifier":"not"}},"qualification":null},{"reference":{"builtinModule":"System.IO.Error"},"usedName":{"valueName":{"identifier":"tryIOError"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"constructorName":{"identifier":"Left"},"constructorTypeName":{"identifier":"Either"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"constructorName":{"identifier":"Right"},"constructorTypeName":{"identifier":"Either"}},"qualification":null},{"reference":{"otherSlice":7954474468895946792},"usedName":{"valueName":{"identifier":"getSymbolicLinkTarget"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"fromMaybe"}},"qualification":null},{"reference":{"otherSlice":5688578446698445564},"usedName":{"valueName":{"identifier":"joinPath"}},"qualification":null},{"reference":{"builtinModule":"GHC.Num"},"usedName":{"valueName":{"operator":"-"}},"qualification":null}],"fragment":["canonicalizePath :: FilePath -> IO FilePath","canonicalizePath\n  = \\ path ->\n      modifyIOError\n        ((`ioeAddLocation` \"canonicalizePath\") . (`ioeSetFileName` path))\n        $\n        dropTrailingPathSeparator . normalise <$>\n          (transform =<< prependCurrentDirectory path)\n  where transform path\n          = do encoding <- getFileSystemEncoding\n               let realpath path'\n                     = GHC.withCString encoding path'\n                         (`withRealpath` GHC.peekCString encoding)\n               attemptRealpath realpath path\n        simplify = return\n        attemptRealpath realpath\n          = attemptRealpathWith (64 :: Int) Nothing realpath <=< simplify\n        attemptRealpathWith n mFallback realpath path\n          = case mFallback of\n                Just fallback | n <= 0 -> return fallback\n                _ -> realpathPrefix (reverse (zip prefixes suffixes))\n          where segments = splitDirectories path\n                prefixes = scanl1 (</>) segments\n                suffixes = tail (scanr (</>) \"\" segments)\n                realpathPrefix candidates\n                  = case candidates of\n                        [] -> return path\n                        (prefix, suffix) : rest -> do exist <- doesPathExist prefix\n                                                      if not exist then realpathPrefix rest else\n                                                        do mp <- tryIOError (realpath prefix)\n                                                           case mp of\n                                                               Left _ -> realpathPrefix rest\n                                                               Right p -> realpathFurther\n                                                                            (p </> suffix)\n                                                                            p\n                                                                            suffix\n                realpathFurther fallback p suffix\n                  = case splitDirectories suffix of\n                        [] -> return fallback\n                        next : restSuffix -> do mTarget <- tryIOError\n                                                             (getSymbolicLinkTarget (p </> next))\n                                                case mTarget of\n                                                    Left _ -> return fallback\n                                                    Right target -> do let mFallback'\n                                                                             = Just\n                                                                                 (fromMaybe fallback\n                                                                                    mFallback)\n                                                                       path' <- simplify\n                                                                                  (p </> target </>\n                                                                                     joinPath\n                                                                                       restSuffix)\n                                                                       attemptRealpathWith (n - 1)\n                                                                         mFallback'\n                                                                         realpath\n                                                                         path'"],"instances":[],"language":{"extensions":["MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}