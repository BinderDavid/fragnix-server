{"sliceID":8437999126740322595,"uses":[{"reference":{"otherSlice":2270124290948061460},"usedName":{"constructorName":{"identifier":"CompressParams"},"constructorTypeName":{"identifier":"CompressParams"}},"qualification":null},{"reference":{"otherSlice":6920138363445826607},"usedName":{"valueName":{"identifier":"deflateInit"}},"qualification":"Stream"},{"reference":{"otherSlice":5578418172209195165},"usedName":{"valueName":{"identifier":"null"}},"qualification":"S"},{"reference":{"otherSlice":4942888801223460576},"usedName":{"constructorName":{"identifier":"PS"},"constructorTypeName":{"identifier":"ByteString"}},"qualification":"S"},{"reference":{"otherSlice":2438889054649508440},"usedName":{"valueName":{"identifier":"pushInputBuffer"}},"qualification":"Stream"},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Int"}},"qualification":null},{"reference":{"otherSlice":125078826469118394},"usedName":{"typeName":{"identifier":"Stream"}},"qualification":null},{"reference":{"otherSlice":7511316425710433924},"usedName":{"typeName":{"identifier":"CompressStream"}},"qualification":null},{"reference":{"otherSlice":4299912725604565780},"usedName":{"valueName":{"identifier":"inputBufferEmpty"}},"qualification":"Stream"},{"reference":{"otherSlice":8344351380459691799},"usedName":{"valueName":{"identifier":"outputBufferFull"}},"qualification":"Stream"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"assert"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"||"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"when"}},"qualification":null},{"reference":{"otherSlice":6081837442328270425},"usedName":{"valueName":{"identifier":"unsafeLiftIO"}},"qualification":"Stream"},{"reference":{"otherSlice":5831756764704217508},"usedName":{"valueName":{"identifier":"mallocByteString"}},"qualification":"S"},{"reference":{"otherSlice":1370855017399076314},"usedName":{"valueName":{"identifier":"pushOutputBuffer"}},"qualification":"Stream"},{"reference":{"otherSlice":7511316425710433924},"usedName":{"constructorName":{"identifier":"CompressInputRequired"},"constructorTypeName":{"identifier":"CompressStream"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"identifier":"not"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"&&"}},"qualification":null},{"reference":{"otherSlice":5043121916374987432},"usedName":{"constructorName":{"identifier":"Finish"},"constructorTypeName":{"identifier":"Flush"}},"qualification":"Stream"},{"reference":{"otherSlice":5043121916374987432},"usedName":{"constructorName":{"identifier":"NoFlush"},"constructorTypeName":{"identifier":"Flush"}},"qualification":"Stream"},{"reference":{"otherSlice":3956186813600730684},"usedName":{"valueName":{"identifier":"deflate"}},"qualification":"Stream"},{"reference":{"otherSlice":6838698599539143293},"usedName":{"constructorName":{"identifier":"Ok"},"constructorTypeName":{"identifier":"Status"}},"qualification":"Stream"},{"reference":{"otherSlice":8735927270208365979},"usedName":{"valueName":{"identifier":"popOutputBuffer"}},"qualification":"Stream"},{"reference":{"otherSlice":7511316425710433924},"usedName":{"constructorName":{"identifier":"CompressOutputAvailable"},"constructorTypeName":{"identifier":"CompressStream"}},"qualification":null},{"reference":{"otherSlice":1547024444436564855},"usedName":{"valueName":{"identifier":"defaultCompressBufferSize"}},"qualification":null},{"reference":{"otherSlice":6838698599539143293},"usedName":{"constructorName":{"identifier":"StreamEnd"},"constructorTypeName":{"identifier":"Status"}},"qualification":"Stream"},{"reference":{"otherSlice":961301712449725147},"usedName":{"valueName":{"identifier":"outputBufferBytesAvailable"}},"qualification":"Stream"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":">"}},"qualification":null},{"reference":{"otherSlice":1703996068210287062},"usedName":{"valueName":{"identifier":"finalise"}},"qualification":"Stream"},{"reference":{"otherSlice":7511316425710433924},"usedName":{"constructorName":{"identifier":"CompressStreamEnd"},"constructorTypeName":{"identifier":"CompressStream"}},"qualification":null},{"reference":{"otherSlice":6838698599539143293},"usedName":{"constructorName":{"identifier":"Error"},"constructorTypeName":{"identifier":"Status"}},"qualification":"Stream"},{"reference":{"otherSlice":5314974955151735278},"usedName":{"constructorName":{"identifier":"BufferError"},"constructorTypeName":{"identifier":"ErrorCode"}},"qualification":"Stream"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"fail"}},"qualification":null},{"reference":{"otherSlice":5314974955151735278},"usedName":{"constructorName":{"identifier":"NeedDict"},"constructorTypeName":{"identifier":"ErrorCode"}},"qualification":"Stream"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"typeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"typeName":{"identifier":"ByteString"}},"qualification":"S"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"otherSlice":612091274707709231},"usedName":{"valueName":{"identifier":"formatSupportsDictionary"}},"qualification":"Stream"},{"reference":{"otherSlice":705808472477945489},"usedName":{"valueName":{"identifier":"deflateSetDictionary"}},"qualification":"Stream"},{"reference":{"otherSlice":4182049159116233466},"usedName":{"typeName":{"identifier":"Format"}},"qualification":"Stream"},{"reference":{"otherSlice":2270124290948061460},"usedName":{"typeName":{"identifier":"CompressParams"}},"qualification":null}],"fragment":["compressStream ::\n               Stream.Format ->\n                 CompressParams -> S.ByteString -> Stream (CompressStream Stream)","compressStream format\n  (CompressParams compLevel method bits memLevel strategy\n     initChunkSize mdict)\n  = \\ chunk ->\n      do Stream.deflateInit format compLevel method bits memLevel\n           strategy\n         setDictionary mdict\n         case chunk of\n             _ | S.null chunk -> fillBuffers 20\n             S.PS inFPtr offset length -> do Stream.pushInputBuffer inFPtr\n                                               offset\n                                               length\n                                             fillBuffers initChunkSize\n  where fillBuffers :: Int -> Stream (CompressStream Stream)\n        fillBuffers outChunkSize\n          = do inputBufferEmpty <- Stream.inputBufferEmpty\n               outputBufferFull <- Stream.outputBufferFull\n               assert (inputBufferEmpty || outputBufferFull) $ return ()\n               when outputBufferFull $\n                 do outFPtr <- Stream.unsafeLiftIO (S.mallocByteString outChunkSize)\n                    Stream.pushOutputBuffer outFPtr 0 outChunkSize\n               if inputBufferEmpty then\n                 return $\n                   CompressInputRequired $\n                     \\ chunk ->\n                       case chunk of\n                           _ | S.null chunk -> drainBuffers True\n                           S.PS inFPtr offset length -> do Stream.pushInputBuffer inFPtr\n                                                             offset\n                                                             length\n                                                           drainBuffers False\n                 else drainBuffers False\n        \n        drainBuffers :: Bool -> Stream (CompressStream Stream)\n        drainBuffers lastChunk\n          = do inputBufferEmpty' <- Stream.inputBufferEmpty\n               outputBufferFull' <- Stream.outputBufferFull\n               assert\n                 (not outputBufferFull' && (lastChunk || not inputBufferEmpty'))\n                 $ return ()\n               let flush = if lastChunk then Stream.Finish else Stream.NoFlush\n               status <- Stream.deflate flush\n               case status of\n                   Stream.Ok -> do outputBufferFull <- Stream.outputBufferFull\n                                   if outputBufferFull then\n                                     do (outFPtr, offset, length) <- Stream.popOutputBuffer\n                                        let chunk = S.PS outFPtr offset length\n                                        return $\n                                          CompressOutputAvailable chunk $\n                                            do fillBuffers defaultCompressBufferSize\n                                     else do fillBuffers defaultCompressBufferSize\n                   Stream.StreamEnd -> do inputBufferEmpty <- Stream.inputBufferEmpty\n                                          assert inputBufferEmpty $ return ()\n                                          outputBufferBytesAvailable <- Stream.outputBufferBytesAvailable\n                                          if outputBufferBytesAvailable > 0 then\n                                            do (outFPtr, offset, length) <- Stream.popOutputBuffer\n                                               let chunk = S.PS outFPtr offset length\n                                               Stream.finalise\n                                               return $\n                                                 CompressOutputAvailable chunk\n                                                   (return CompressStreamEnd)\n                                            else\n                                            do Stream.finalise\n                                               return CompressStreamEnd\n                   Stream.Error code msg -> case code of\n                                                Stream.BufferError -> fail\n                                                                        \"BufferError should be impossible!\"\n                                                Stream.NeedDict _ -> fail \"NeedDict is impossible!\"\n                                                _ -> fail msg\n        \n        setDictionary :: Maybe S.ByteString -> Stream ()\n        setDictionary (Just dict)\n          | Stream.formatSupportsDictionary format =\n            do status <- Stream.deflateSetDictionary dict\n               case status of\n                   Stream.Ok -> return ()\n                   Stream.Error _ msg -> fail msg\n                   _ -> fail \"error when setting deflate dictionary\"\n        setDictionary _ = return ()"],"instances":[],"language":{"extensions":["RankNTypes","DeriveDataTypeable","BangPatterns","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}