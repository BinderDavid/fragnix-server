{"sliceID":2054657640094116658,"uses":[{"reference":{"otherSlice":1178554266560336621},"usedName":{"constructorName":{"identifier":"AllocationStrategy"},"constructorTypeName":{"identifier":"AllocationStrategy"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>="}},"qualification":null},{"reference":{"otherSlice":3168676294647372473},"usedName":{"constructorName":{"identifier":"Buffer"},"constructorTypeName":{"identifier":"Buffer"}},"qualification":null},{"reference":{"otherSlice":6120186047343851254},"usedName":{"constructorName":{"identifier":"BufferRange"},"constructorTypeName":{"identifier":"BufferRange"}},"qualification":null},{"reference":{"otherSlice":715810349346019356},"usedName":{"valueName":{"identifier":"fillWithBuildStep"}},"qualification":null},{"reference":{"builtinModule":"GHC.ForeignPtr"},"usedName":{"valueName":{"identifier":"touchForeignPtr"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.ForeignPtr"},"usedName":{"valueName":{"identifier":"unsafeForeignPtrToPtr"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":7462151234930183679},"usedName":{"constructorName":{"identifier":"Finished"},"constructorTypeName":{"identifier":"ChunkIOStream"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"const"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"identifier":"max"}},"qualification":null},{"reference":{"otherSlice":4265093386450397246},"usedName":{"valueName":{"identifier":"yield1"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"otherSlice":3730763711957041450},"usedName":{"valueName":{"identifier":"create"}},"qualification":"S"},{"reference":{"builtinModule":"Foreign.Marshal.Utils"},"usedName":{"valueName":{"identifier":"copyBytes"}},"qualification":null},{"reference":{"otherSlice":7462151234930183679},"usedName":{"constructorName":{"identifier":"Yield1"},"constructorTypeName":{"identifier":"ChunkIOStream"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"False"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"otherSlice":4942888801223460576},"usedName":{"constructorName":{"identifier":"PS"},"constructorTypeName":{"identifier":"ByteString"}},"qualification":"S"},{"reference":{"builtinModule":"GHC.Ptr"},"usedName":{"valueName":{"identifier":"minusPtr"}},"qualification":null},{"reference":{"otherSlice":1178554266560336621},"usedName":{"typeName":{"identifier":"AllocationStrategy"}},"qualification":null},{"reference":{"otherSlice":7635270134028731009},"usedName":{"typeName":{"identifier":"BuildStep"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":7462151234930183679},"usedName":{"typeName":{"identifier":"ChunkIOStream"}},"qualification":null}],"fragment":["buildStepToCIOS ::\n                AllocationStrategy -> BuildStep a -> IO (ChunkIOStream a)","buildStepToCIOS !(AllocationStrategy nextBuffer bufSize trim)\n  = \\ step -> nextBuffer Nothing >>= fill step\n  where fill !step !buf@(Buffer fpbuf br@(BufferRange _ pe))\n          = do res <- fillWithBuildStep step doneH fullH insertChunkH br\n               touchForeignPtr fpbuf\n               return res\n          where pbuf = unsafeForeignPtrToPtr fpbuf\n                doneH op' x\n                  = return $ Finished (Buffer fpbuf (BufferRange op' pe)) x\n                fullH op' minSize nextStep\n                  = wrapChunk op' $\n                      const $\n                        nextBuffer (Just (buf, max minSize bufSize)) >>= fill nextStep\n                insertChunkH op' bs nextStep\n                  = wrapChunk op' $\n                      \\ isEmpty ->\n                        yield1 bs $\n                          if isEmpty then fill nextStep buf else\n                            do buf' <- nextBuffer (Just (buf, bufSize))\n                               fill nextStep buf'\n                \n                {-# INLINE wrapChunk #-}\n                wrapChunk !op' mkCIOS\n                  | chunkSize == 0 = mkCIOS True\n                  | trim chunkSize size =\n                    do bs <- S.create chunkSize $\n                               \\ pbuf' -> copyBytes pbuf' pbuf chunkSize\n                       return $ Yield1 bs (mkCIOS False)\n                  | otherwise =\n                    return $ Yield1 (S.PS fpbuf 0 chunkSize) (mkCIOS False)\n                  where chunkSize = op' `minusPtr` pbuf\n                        size = pe `minusPtr` pbuf"],"instances":[],"language":{"extensions":["ScopedTypeVariables","BangPatterns","RankNTypes","Unsafe","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}