{"sliceID":349034285185014456,"uses":[{"reference":{"builtinModule":"Control.Monad.IO.Class"},"usedName":{"valueName":{"identifier":"liftIO"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":411829575474976757},"usedName":{"valueName":{"identifier":"isStdStream"}},"qualification":null},{"reference":{"otherSlice":4305086082034101856},"usedName":{"valueName":{"identifier":"osStdStream"}},"qualification":null},{"reference":{"otherSlice":3988698958814384118},"usedName":{"valueName":{"identifier":"createProcess_"}},"qualification":"PI"},{"reference":{"otherSlice":6693766690905093622},"usedName":{"valueName":{"identifier":"std_in"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"fromMaybe"}},"qualification":null},{"reference":{"otherSlice":6693766690905093622},"usedName":{"valueName":{"identifier":"std_out"}},"qualification":null},{"reference":{"otherSlice":6693766690905093622},"usedName":{"valueName":{"identifier":"std_err"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"atomically"}},"qualification":null},{"reference":{"otherSlice":8095853467634388848},"usedName":{"valueName":{"identifier":"newEmptyTMVar"}},"qualification":null},{"reference":{"builtinModule":"GHC.Conc.Sync"},"usedName":{"valueName":{"identifier":"forkIOWithUnmask"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"try"}},"qualification":null},{"reference":{"otherSlice":6886756863672815612},"usedName":{"valueName":{"identifier":"waitForProcess"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":">>="}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"."}},"qualification":null},{"reference":{"otherSlice":721825598378126439},"usedName":{"valueName":{"identifier":"putTMVar"}},"qualification":null},{"reference":{"builtinModule":"Data.Either"},"usedName":{"valueName":{"identifier":"either"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"valueName":{"identifier":"throw"}},"qualification":null},{"reference":{"builtinModule":"GHC.Exception"},"usedName":{"typeName":{"identifier":"SomeException"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"id"}},"qualification":null},{"reference":{"builtinModule":"Control.Exception.Base"},"usedName":{"valueName":{"identifier":"finally"}},"qualification":null},{"reference":{"builtinModule":"Data.Maybe"},"usedName":{"valueName":{"identifier":"maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"builtinModule":"GHC.IO.Handle"},"usedName":{"valueName":{"identifier":"hClose"}},"qualification":null},{"reference":{"builtinModule":"Data.Functor"},"usedName":{"valueName":{"operator":"<$>"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"<*>"}},"qualification":null},{"reference":{"otherSlice":7605354660967591149},"usedName":{"constructorName":{"identifier":"StreamingProcessHandle"},"constructorTypeName":{"identifier":"StreamingProcessHandle"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad.IO.Class"},"usedName":{"typeName":{"identifier":"MonadIO"}},"qualification":null},{"reference":{"otherSlice":411829575474976757},"usedName":{"typeName":{"identifier":"InputSource"}},"qualification":null},{"reference":{"otherSlice":4305086082034101856},"usedName":{"typeName":{"identifier":"OutputSink"}},"qualification":null},{"reference":{"otherSlice":6693766690905093622},"usedName":{"typeName":{"identifier":"CreateProcess"}},"qualification":null},{"reference":{"otherSlice":7605354660967591149},"usedName":{"typeName":{"identifier":"StreamingProcessHandle"}},"qualification":null}],"fragment":["streamingProcess ::\n                   (MonadIO m, InputSource stdin, OutputSink stdout,\n                    OutputSink stderr) =>\n                   CreateProcess -> m (stdin, stdout, stderr, StreamingProcessHandle)","streamingProcess cp\n  = liftIO $\n      do let (getStdin, stdinStream) = isStdStream\n             (getStdout, stdoutStream) = osStdStream\n             (getStderr, stderrStream) = osStdStream\n         (stdinH, stdoutH, stderrH, ph) <- PI.createProcess_\n                                             \"streamingProcess\"\n                                             cp{std_in = fromMaybe (std_in cp) stdinStream,\n                                                std_out = fromMaybe (std_out cp) stdoutStream,\n                                                std_err = fromMaybe (std_err cp) stderrStream}\n         ec <- atomically newEmptyTMVar\n         _ <- forkIOWithUnmask $\n                \\ _unmask ->\n                  try (waitForProcess ph) >>=\n                    atomically . putTMVar ec . either (throw :: SomeException -> a) id\n         let close\n               = mclose stdinH `finally` mclose stdoutH `finally` mclose stderrH\n               where mclose = maybe (return ()) hClose\n         (,,,) <$> getStdin stdinH <*> getStdout stdoutH <*>\n           getStderr stderrH\n           <*> return (StreamingProcessHandle ph ec close)"],"instances":[],"language":{"extensions":["DeriveDataTypeable","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}