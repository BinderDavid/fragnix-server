{"sliceID":5670716883553269128,"uses":[{"reference":{"otherSlice":4936577217946727749},"usedName":{"valueName":{"identifier":"getProtocolNumber"}},"qualification":null},{"reference":{"otherSlice":6075950661007029221},"usedName":{"valueName":{"identifier":"defaultHints"}},"qualification":null},{"reference":{"otherSlice":1781973223832186205},"usedName":{"valueName":{"identifier":"addrFlags"}},"qualification":null},{"reference":{"otherSlice":6396638856057598282},"usedName":{"constructorName":{"identifier":"AI_ADDRCONFIG"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":null},{"reference":{"otherSlice":6396638856057598282},"usedName":{"constructorName":{"identifier":"AI_PASSIVE"},"constructorTypeName":{"identifier":"AddrInfoFlag"}},"qualification":null},{"reference":{"otherSlice":1781973223832186205},"usedName":{"valueName":{"identifier":"addrSocketType"}},"qualification":null},{"reference":{"otherSlice":1575450884604877623},"usedName":{"constructorName":{"identifier":"Stream"},"constructorTypeName":{"identifier":"SocketType"}},"qualification":null},{"reference":{"otherSlice":1781973223832186205},"usedName":{"valueName":{"identifier":"addrProtocol"}},"qualification":null},{"reference":{"otherSlice":2971289438803712817},"usedName":{"valueName":{"identifier":"getAddrInfo"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"filter"}},"qualification":null},{"reference":{"otherSlice":1781973223832186205},"usedName":{"valueName":{"identifier":"addrFamily"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"=="}},"qualification":null},{"reference":{"otherSlice":7599519667858710776},"usedName":{"constructorName":{"identifier":"AF_INET6"},"constructorTypeName":{"identifier":"Family"}},"qualification":null},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"null"}},"qualification":null},{"reference":{"builtinModule":"GHC.List"},"usedName":{"valueName":{"identifier":"head"}},"qualification":null},{"reference":{"otherSlice":4615389594112811098},"usedName":{"valueName":{"identifier":"bracketOnError"}},"qualification":null},{"reference":{"otherSlice":1339151303418925646},"usedName":{"valueName":{"identifier":"socket"}},"qualification":null},{"reference":{"otherSlice":1611398500982021929},"usedName":{"valueName":{"identifier":"sClose"}},"qualification":null},{"reference":{"otherSlice":8056330025569894447},"usedName":{"valueName":{"identifier":"setSocketOption"}},"qualification":null},{"reference":{"otherSlice":6674542350474729315},"usedName":{"constructorName":{"identifier":"ReuseAddr"},"constructorTypeName":{"identifier":"SocketOption"}},"qualification":null},{"reference":{"otherSlice":5782321467879302793},"usedName":{"valueName":{"identifier":"bind"}},"qualification":null},{"reference":{"otherSlice":1781973223832186205},"usedName":{"valueName":{"identifier":"addrAddress"}},"qualification":null},{"reference":{"otherSlice":3947819997517908848},"usedName":{"valueName":{"identifier":"listen"}},"qualification":null},{"reference":{"otherSlice":5996347524704924816},"usedName":{"valueName":{"identifier":"maxListenQueue"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":3565051758154240159},"usedName":{"typeName":{"identifier":"ServiceName"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"typeName":{"identifier":"IO"}},"qualification":null},{"reference":{"otherSlice":2347089666054590766},"usedName":{"typeName":{"identifier":"Socket"}},"qualification":null}],"fragment":["listen' :: ServiceName -> IO Socket","listen' serv\n  = do proto <- getProtocolNumber \"tcp\"\n       let hints\n             = defaultHints{addrFlags = [AI_ADDRCONFIG, AI_PASSIVE],\n                            addrSocketType = Stream, addrProtocol = proto}\n       addrs <- getAddrInfo (Just hints) Nothing (Just serv)\n       let addrs' = filter (\\ x -> addrFamily x == AF_INET6) addrs\n           addr = if null addrs' then head addrs else head addrs'\n       bracketOnError\n         (socket (addrFamily addr) (addrSocketType addr)\n            (addrProtocol addr))\n         (sClose)\n         (\\ sock ->\n            do setSocketOption sock ReuseAddr 1\n               bind sock (addrAddress addr)\n               listen sock maxListenQueue\n               return sock)"],"instances":[],"language":{"extensions":["DeriveDataTypeable","ForeignFunctionInterface","TypeSynonymInstances","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}