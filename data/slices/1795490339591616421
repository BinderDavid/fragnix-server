{"sliceID":1795490339591616421,"uses":[{"reference":{"otherSlice":3651195766347386861},"usedName":{"valueName":{"identifier":"getClientCookies"}},"qualification":null},{"reference":{"otherSlice":8730494103450658381},"usedName":{"valueName":{"identifier":"append"}},"qualification":"T"},{"reference":{"otherSlice":501307744618215836},"usedName":{"valueName":{"identifier":"intercalate"}},"qualification":"T"},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"pathInfo"}},"qualification":null},{"reference":{"builtinModule":"Control.Monad.IO.Class"},"usedName":{"valueName":{"identifier":"liftIO"}},"qualification":null},{"reference":{"otherSlice":4231822192820893145},"usedName":{"valueName":{"identifier":"getCurrentTime"}},"qualification":null},{"reference":{"otherSlice":2500421926550002906},"usedName":{"valueName":{"identifier":"filter"}},"qualification":"Map"},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"&&"}},"qualification":null},{"reference":{"otherSlice":9079646820445488578},"usedName":{"valueName":{"identifier":"setCookieName"}},"qualification":"Cookie"},{"reference":{"otherSlice":9079646820445488578},"usedName":{"valueName":{"identifier":"setCookieValue"}},"qualification":"Cookie"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"map"}},"qualification":null},{"reference":{"builtinModule":"Data.Tuple"},"usedName":{"valueName":{"identifier":"snd"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"operator":"$"}},"qualification":null},{"reference":{"otherSlice":9052798855731931041},"usedName":{"valueName":{"identifier":"toList"}},"qualification":"Map"},{"reference":{"otherSlice":3802872221109577852},"usedName":{"valueName":{"identifier":"toByteString"}},"qualification":null},{"reference":{"otherSlice":630898744288229406},"usedName":{"valueName":{"identifier":"renderCookies"}},"qualification":"Cookie"},{"reference":{"builtinModule":"Data.Foldable"},"usedName":{"valueName":{"identifier":"null"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"otherwise"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"valueName":{"identifier":"return"}},"qualification":null},{"reference":{"otherSlice":2150836866812832620},"usedName":{"valueName":{"identifier":"requestHeaders"}},"qualification":null},{"reference":{"otherSlice":9079646820445488578},"usedName":{"valueName":{"identifier":"setCookieExpires"}},"qualification":"Cookie"},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Nothing"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Types"},"usedName":{"constructorName":{"identifier":"True"},"constructorTypeName":{"identifier":"Bool"}},"qualification":null},{"reference":{"builtinModule":"GHC.Base"},"usedName":{"constructorName":{"identifier":"Just"},"constructorTypeName":{"identifier":"Maybe"}},"qualification":null},{"reference":{"builtinModule":"GHC.Classes"},"usedName":{"valueName":{"operator":"<"}},"qualification":null},{"reference":{"otherSlice":9079646820445488578},"usedName":{"valueName":{"identifier":"setCookiePath"}},"qualification":"Cookie"},{"reference":{"otherSlice":404915850270007730},"usedName":{"valueName":{"identifier":"isPrefixOf"}},"qualification":"S8"},{"reference":{"otherSlice":356524144169200018},"usedName":{"valueName":{"identifier":"encodeUtf8"}},"qualification":"TE"},{"reference":{"otherSlice":2150836866812832620},"usedName":{"typeName":{"identifier":"Request"}},"qualification":null},{"reference":{"otherSlice":6144584388836266359},"usedName":{"typeName":{"identifier":"Session"}},"qualification":null}],"fragment":["addCookiesToRequest :: Request -> Session Request","addCookiesToRequest req\n  = do oldClientCookies <- getClientCookies\n       let requestPath = \"/\" `T.append` T.intercalate \"/\" (pathInfo req)\n       currentUTCTime <- liftIO getCurrentTime\n       let cookiesForRequest\n             = Map.filter\n                 (\\ c ->\n                    checkCookieTime currentUTCTime c && checkCookiePath requestPath c)\n                 oldClientCookies\n       let cookiePairs\n             = [(Cookie.setCookieName c, Cookie.setCookieValue c) |\n                c <- map snd $ Map.toList cookiesForRequest]\n       let cookieValue = toByteString $ Cookie.renderCookies cookiePairs\n           addCookieHeader rest\n             | null cookiePairs = rest\n             | otherwise = (\"Cookie\", cookieValue) : rest\n       return $ req{requestHeaders = addCookieHeader $ requestHeaders req}\n  where checkCookieTime t c\n          = case Cookie.setCookieExpires c of\n                Nothing -> True\n                Just t' -> t < t'\n        checkCookiePath p c\n          = case Cookie.setCookiePath c of\n                Nothing -> True\n                Just p' -> p' `S8.isPrefixOf` TE.encodeUtf8 p"],"instances":[],"language":{"extensions":["OverloadedStrings","DeriveDataTypeable","MultiParamTypeClasses","NondecreasingIndentation","ExplicitForAll","PatternGuards"]}}